<% title(@plate.name, "Plates") %>
<header>
  <h1><%= @plate.name %></h1>

  <ul class="actions">
    <%= render partial: "application_partials/auth_edit_record", locals: {record: @plate} %>
    <%= render partial: "application_partials/auth_destroy_record", locals: {record: @plate} %>
  </ul>
</header>

<%= render partial: "application_partials/record_meta", locals: { record: @plate } %>

<table class="attributes">
	<tr>
  	<th><strong>Name:</strong></th>
  	<td><%= @plate.name %>
	</tr>

	<tr>
  	<th><strong>Sequencing library prep kit:</strong></th>
		<% if @plate.sequencing_library_prep_kit.present? %>
  		<td><%= link_to @plate.sequencing_library_prep_kit.name, @plate.sequencing_library_prep_kit %></td>
		<% else %>
			<td></td>
		<% end %>
	</tr>

	<tr>
  	<th><strong>Paired end:</strong></th>
  	<td><%= @plate.paired_end %></td>
	</tr>

	<tr>
  	<th><strong>Dimensions:</strong></th>
		<td><%= "#{@plate.nrow}x#{@plate.ncol}" %></td>
	</tr>

	<tr>
  	<th><strong>Vendor:</strong></th>
  	<td><%= link_to @plate.vendor.name, @plate.vendor %></td>
	</tr>

	<tr>
  	<th><strong>Vendor product identifier:</strong></th>
  	<td><%= @plate.vendor_product_identifier %></td>
	</tr>
</table>

<div class="jumbotron">
<h3>Plate Layout</h3>
<table class="plate-table">
	<tr><th></th>
		<% (1..@plate.ncol).each do |c| %>
			<th><%= c %></th>
		<% end %>
	</tr>
	<% (1..@plate.nrow).each do |r| %>
		<tr><th><%= Plate::row_letter(r) %></th>
		<% (1..@plate.ncol).each do |c| %>
			<% well = @plate.wells.find_by!({row: r, col: c}) %>
			<% if well.fail? %>
				<% class_val = "failure" %>
			<% else %>
				<% class_val = "success" %>
			<% end %>
			<td><%= link_to well.name, [@plate,well], class: "#{class_val}" %></td>
		<% end %>
		</tr>
	<% end %>
</table></br>
</div>

<% tooltip = "Enter barcodes in matrix format (same format as the plate), such that barcode in position [1,1] corresponds to well A1, and the barcode in position [2,2] corresponds to well B2 ... Use a single tab to delimit values; for wells without barcodes just leave the corresponding field empty." %>
<% if @plate.paired_end? %>
  <%= simple_form_for(@plate) do |f| %>
    <%= f.input :add_paired_barcodes, as: :text, placeholder: "ATCCGC-GTACAG\nCGTGAC-TAGGCA\n...",
				label_html: {"data-toggle" => "tooltip", "title" => "#{tooltip}" },
        hint: "Copy and paste paired-barcodes in - if there are any validation errors, you'll have to paste them all back in with the corrections." %>

    <div class="actions">
     <%= f.button :submit, "Add Paired Barcodes", class: "btn-primary "%>
    </div></br>
  <% end %>

<% else %>

  <%= simple_form_for(@plate) do |f| %>
    <%= f.input :add_barcodes, as: :text, placeholder: "ATCCGA\nTAGCGA\n...", 
				label_html: {"data-toggle" => "tooltip", "title" => "#{tooltip}"},
        hint: "Copy and paste barcodes in - if there are any validation errors, you'll have to paste them all back in with the corrections." %>

    <div class="actions">
     <%= f.button :submit, "Add Barcodes", class: "btn-primary "%>
    </div></br>
  <% end %>
<% end %>
</br></br>

<%= link_to 'Back', plates_path %>
